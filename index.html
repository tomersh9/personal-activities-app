<!DOCTYPE html>
<html lang="he" dir="rtl">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>××¢×§×‘ ×¤×¢×™×œ×•×™×•×ª</title>
		<link rel="icon" type="image/png" href="favicon.png" />
		<link rel="apple-touch-icon" href="icon-32.png" />
		<link rel="manifest" href="manifest.json" />
		<meta name="theme-color" content="#667eea" />
		<style>
			* {
				margin: 0;
				padding: 0;
				box-sizing: border-box;
			}

			body {
				font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, sans-serif;
				background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
				min-height: 100vh;
				padding: 20px;
				color: #333;
			}

			.container {
				max-width: 1200px;
				margin: 0 auto;
			}

			.header {
				text-align: center;
				color: white;
				margin-bottom: 30px;
			}

			.header h1 {
				font-size: 2.5em;
				margin-bottom: 10px;
				text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
			}

			.nav {
				display: flex;
				gap: 10px;
				justify-content: center;
				margin-bottom: 30px;
				flex-wrap: wrap;
			}

			.nav-btn {
				padding: 12px 24px;
				background: white;
				border: none;
				border-radius: 25px;
				cursor: pointer;
				font-size: 16px;
				font-weight: 600;
				transition: all 0.1s;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
			}

			.nav-btn:hover {
				box-shadow: 0 6px 12px rgba(0, 0, 0, 0.15);
			}

			.nav-btn.active {
				background: #4caf50;
				color: white;
			}

			.nav-btn.refresh-btn {
				font-size: 32px;
				padding: 0;
				background: none;
				border: none;
				box-shadow: none;
			}

			.page {
				display: none;
			}

			.page.active {
				display: block;
			}

			.activities-grid {
				display: grid;
				grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
				gap: 20px;
				margin-bottom: 20px;
			}

			.activity-card {
				background: white;
				border-radius: 15px;
				padding: 30px 20px;
				text-align: center;
				cursor: pointer;
				transition: all 0.1s;
				box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
				min-height: 200px;
				display: flex;
				flex-direction: column;
				justify-content: center;
				position: relative;
				cursor: grab;
			}

			.activity-card:active {
				cursor: grabbing;
			}

			.activity-card.dragging {
				opacity: 0.5;
				cursor: grabbing;
			}

			.activity-card.drag-over {
				transform: scale(1.05);
				box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
			}

			.activity-card:hover {
				box-shadow: 0 8px 15px rgba(0, 0, 0, 0.2);
			}

			.activity-name {
				font-size: 1.4em;
				font-weight: bold;
				margin-bottom: 15px;
				color: white;
				text-shadow: 1px 1px 3px rgba(0, 0, 0, 0.3);
			}

			.activity-info {
				font-size: 0.9em;
				color: white;
				margin-top: 10px;
				text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
			}

			.last-activity {
				font-size: 0.85em;
				color: white;
				margin-top: 5px;
				text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.3);
			}

			.delete-btn {
				position: absolute;
				top: 10px;
				right: 10px;
				background: rgba(255, 255, 255, 0.9);
				border: none;
				border-radius: 50%;
				width: 20px;
				height: 20px;
				cursor: pointer;
				font-size: 18px;
				color: #e63946;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: all 0.1s;
				z-index: 10;
			}

			.delete-btn:hover {
				background: #e63946;
				color: white;
			}

			.edit-btn {
				position: absolute;
				top: 10px;
				left: 10px;
				background: rgba(255, 255, 255, 0.9);
				border: none;
				border-radius: 50%;
				width: 20px;
				height: 20px;
				cursor: pointer;
				font-size: 12px;
				color: #667eea;
				display: flex;
				align-items: center;
				justify-content: center;
				transition: all 0.1s;
				z-index: 10;
				font-weight: bold;
			}

			.edit-btn:hover {
				background: #667eea;
				color: white;
			}

			.add-activity-card {
				background: rgba(255, 255, 255, 0.3);
				border: 3px dashed white;
				display: flex;
				align-items: center;
				justify-content: center;
				font-size: 3em;
				color: white;
			}

			.modal {
				display: none;
				position: fixed;
				top: 0;
				left: 0;
				width: 100%;
				height: 100%;
				background: rgba(0, 0, 0, 0.5);
				z-index: 1000;
				padding: 20px;
			}

			.modal.active {
				display: flex;
				align-items: center;
				justify-content: center;
			}

			.modal-content {
				background: white;
				border-radius: 20px;
				padding: 30px;
				max-width: 500px;
				width: 100%;
				max-height: 90vh;
				overflow-y: auto;
			}

			.modal-header {
				font-size: 1.8em;
				font-weight: bold;
				margin-bottom: 20px;
				color: #667eea;
			}

			.form-group {
				margin-bottom: 20px;
			}

			.form-group label {
				display: block;
				margin-bottom: 8px;
				font-weight: 600;
				color: #555;
			}

			.form-group input[type='text'],
			.form-group input[type='number'] {
				width: 100%;
				padding: 12px;
				border: 2px solid #e0e0e0;
				border-radius: 10px;
				font-size: 16px;
				transition: border 0.3s;
			}

			.form-group input:focus {
				outline: none;
				border-color: #667eea;
			}

			.form-buttons {
				margin-top: 20px;
			}

			.checkbox-group {
				display: flex;
				align-items: center;
				gap: 10px;
			}

			.checkbox-group input[type='checkbox'] {
				width: 20px;
				height: 20px;
				cursor: pointer;
			}

			.btn {
				padding: 12px 30px;
				border: none;
				border-radius: 25px;
				cursor: pointer;
				font-size: 16px;
				font-weight: 600;
				transition: all 0.1s;
				margin-right: 10px;
			}

			.btn-primary {
				background: #667eea;
				color: white;
			}

			.btn-primary:hover {
				background: #5568d3;
			}

			.btn-secondary {
				background: #e0e0e0;
				color: #666;
			}

			.btn-secondary:hover {
				background: #d0d0d0;
			}

			.history-list {
				background: white;
				border-radius: 15px;
				padding: 20px;
				margin-bottom: 20px;
			}

			.activity-section {
				margin-bottom: 30px;
			}

			.activity-section-title {
				font-size: 1.5em;
				font-weight: bold;
				color: #667eea;
				margin-bottom: 15px;
				padding-bottom: 10px;
				border-bottom: 2px solid #e0e0e0;
			}

			.history-item {
				padding: 15px;
				background: #f8f9fa;
				border-radius: 10px;
				margin-bottom: 10px;
				display: flex;
				justify-content: space-between;
				align-items: center;
			}

			.history-date {
				color: #666;
				font-size: 0.9em;
			}

			.history-price {
				font-weight: bold;
				color: #4caf50;
				font-size: 1.1em;
			}

			.total-section {
				background: #667eea;
				color: white;
				padding: 20px;
				border-radius: 15px;
				text-align: center;
				font-size: 1.3em;
				font-weight: bold;
			}

			.previous-logs {
				margin-top: 20px;
				padding-top: 20px;
				border-top: 2px solid #e0e0e0;
			}

			.previous-logs-title {
				font-size: 1.1em;
				font-weight: bold;
				margin-bottom: 10px;
				color: #667eea;
			}

			.log-item {
				padding: 10px;
				background: #f0f0f0;
				border-radius: 8px;
				margin-bottom: 8px;
				font-size: 0.9em;
			}

			.color-picker {
				display: grid;
				grid-template-columns: repeat(6, 1fr);
				gap: 10px;
				margin-top: 10px;
			}

			.color-option {
				width: 100%;
				aspect-ratio: 1;
				border-radius: 8px;
				cursor: pointer;
				border: 3px solid transparent;
				transition: all 0.1s;
			}

			.color-option:hover {
				transform: scale(1.1);
			}

			.color-option.selected {
				border-color: #667eea;
				box-shadow: 0 0 0 2px white, 0 0 0 4px #667eea;
			}

			@media (max-width: 768px) {
				.header h1 {
					font-size: 1.8em;
				}

				.activities-grid {
					grid-template-columns: repeat(auto-fill, minmax(150px, 1fr));
					gap: 15px;
				}

				.activity-card {
					min-height: 150px;
					padding: 20px 15px;
				}

				.activity-name {
					font-size: 1.2em;
				}

				.modal-content {
					padding: 20px;
				}

				.nav-btn {
					padding: 10px 20px;
					font-size: 14px;
				}
			}
		</style>
	</head>
	<body>
		<div class="container">
			<div class="header">
				<h1>ğŸ“Š ××¢×§×‘ ×¤×¢×™×œ×•×™×•×ª</h1>
			</div>

			<div class="nav">
				<button class="nav-btn active" onclick="showPage('home')">×‘×™×ª</button>
				<button class="nav-btn" onclick="showPage('report')">×”×™×¡×˜×•×¨×™×”</button>
				<button class="nav-btn refresh-btn" onclick="location.reload()">ğŸ”„</button>
			</div>

			<div id="homePage" class="page active">
				<div class="activities-grid" id="activitiesGrid">
					<div class="activity-card add-activity-card" onclick="openCreateActivityModal()">+</div>
				</div>
			</div>

			<div id="reportPage" class="page">
				<div class="history-list" id="historyList"></div>
			</div>
		</div>

		<!-- Create Activity Modal -->
		<div id="createActivityModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">×™×¦×™×¨×ª ×¤×¢×™×œ×•×ª ×—×“×©×”</div>
				<div class="form-group">
					<label>×©× ×”×¤×¢×™×œ×•×ª</label>
					<input type="text" id="newActivityName" placeholder="×œ×“×•×’××”: ×—×“×¨ ×›×•×©×¨, ×§×¤×”, ×œ×™××•×“×™×" />
				</div>
				<div class="form-group">
					<div class="checkbox-group">
						<input type="checkbox" id="newActivityHasPrice" />
						<label>×›×•×œ×œ ××¢×§×‘ ××—×™×¨</label>
					</div>
				</div>
				<div class="form-buttons">
					<button class="btn btn-primary" onclick="createActivity()">×¦×•×¨</button>
					<button class="btn btn-secondary" onclick="closeModal('createActivityModal')">×‘×™×˜×•×œ</button>
				</div>
			</div>
		</div>

		<!-- Log Activity Modal -->
		<div id="logActivityModal" class="modal">
			<div class="modal-content">
				<div class="modal-header" id="logActivityTitle"></div>
				<div class="form-group" id="priceGroup" style="display: none">
					<label>××—×™×¨ (â‚ª)</label>
					<input type="number" id="activityPrice" placeholder="0.00" step="0.01" />
				</div>
				<div class="previous-logs" id="previousLogs"></div>
				<div class="form-buttons">
					<button class="btn btn-primary" onclick="logActivity()">×©××•×¨</button>
					<button class="btn btn-secondary" onclick="closeModal('logActivityModal')">×‘×™×˜×•×œ</button>
				</div>
			</div>
		</div>

		<!-- Delete Confirmation Modal -->
		<div id="deleteConfirmModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">×œ××—×•×§ ×¤×¢×™×œ×•×ª?</div>
				<p style="margin-bottom: 20px; color: #666">×”×× ××ª×” ×‘×˜×•×— ×©×‘×¨×¦×•× ×š ×œ××—×•×§ ××ª ×”×¤×¢×™×œ×•×ª ×”×–×•? ×›×œ ×”×¨×™×©×•××™× ×™×™××—×§×• ×’× ×›×Ÿ. ×¤×¢×•×œ×” ×–×• ×œ× × ×™×ª× ×ª ×œ×‘×™×˜×•×œ.</p>
				<div class="form-buttons">
					<button class="btn btn-primary" style="background: #e63946" onclick="confirmDelete()">××—×§</button>
					<button class="btn btn-secondary" onclick="closeModal('deleteConfirmModal')">×‘×™×˜×•×œ</button>
				</div>
			</div>
		</div>

		<!-- Edit Activity Modal -->
		<div id="editActivityModal" class="modal">
			<div class="modal-content">
				<div class="modal-header">×¢×¨×™×›×ª ×¤×¢×™×œ×•×ª</div>
				<div class="form-group">
					<label>×©× ×”×¤×¢×™×œ×•×ª</label>
					<input type="text" id="editActivityName" placeholder="×©× ×”×¤×¢×™×œ×•×ª" />
				</div>
				<div class="form-group">
					<label>×‘×—×¨ ×¦×‘×¢</label>
					<div class="color-picker" id="colorPicker"></div>
				</div>
				<div class="form-buttons">
					<button class="btn btn-primary" onclick="saveActivityEdit()">×©××•×¨</button>
					<button class="btn btn-secondary" onclick="closeModal('editActivityModal')">×‘×™×˜×•×œ</button>
				</div>
			</div>
		</div>

		<script>
			// Load data from localStorage
			let data = JSON.parse(localStorage.getItem('activityTrackerData')) || {
				activities: [],
				logs: [],
				availableColors: [],
			};

			let currentActivity = null;
			let activityToDelete = null;
			let activityToEdit = null;
			let selectedColor = null;
			let draggedElement = null;
			let draggedActivityId = null;

			// Save data to localStorage
			function saveData() {
				localStorage.setItem('activityTrackerData', JSON.stringify(data));
			}

			// Close modal when clicking outside
			document.addEventListener('click', function (e) {
				if (e.target.classList.contains('modal')) {
					e.target.classList.remove('active');
				}
			});

			const colors = [
				'#FF6B6B', // ××“×•× ××œ××•×’×™
				'#FF5252', // ××“×•× ×‘×•×”×§
				'#FF4757', // ××“×•× ×ª×•×ª×™
				'#FF6348', // ××“×•× ×¢×’×‘× ×™×™×”
				'#FF3838', // ××“×•× ×¢×–
				'#FF006E', // ×•×¨×•×“ ×¤×•×§×¡×™×”
				'#FF1493', // ×•×¨×•×“ ×¢××•×§
				'#FF69B4', // ×•×¨×•×“ ×—×
				'#FF85C0', // ×•×¨×•×“ ××ª×•×§
				'#C44569', // ×•×¨×•×“ ×¨×•×–
				'#A855F7', // ×¡×’×•×œ ×—×™
				'#9333EA', // ×¡×’×•×œ ×¢××•×§
				'#8B5CF6', // ×¡×’×•×œ ×‘×•×”×§
				'#7C3AED', // ×¡×’×•×œ ×¨×•×™××œ
				'#6366F1', // ××™× ×“×™×’×• ×—×™
				'#4F46E5', // ××™× ×“×™×’×• ×¢××•×§
				'#3B82F6', // ×›×—×•×œ ×©××™×™×
				'#2563EB', // ×›×—×•×œ ×‘×•×”×§
				'#1D4ED8', // ×›×—×•×œ ××œ×›×•×ª×™
				'#0EA5E9', // ×›×—×•×œ ×‘×¨×™×›×”
				'#06B6D4', // ×¦×™××Ÿ ×‘×•×”×§
				'#14B8A6', // ×˜×•×¨×§×™×– ×—×™
				'#10B981', // ×™×¨×•×§ ××–××¨×’×“
				'#22C55E', // ×™×¨×•×§ ×‘×•×”×§
				'#16A34A', // ×™×¨×•×§ ×¢×©×‘
				'#84CC16', // ×œ×™×™× ×—×™
				'#A3E635', // ×œ×™×™× ×‘×”×™×¨
				'#EAB308', // ×¦×”×•×‘ ×–×”×‘
				'#F59E0B', // ×›×ª×•× ×¢××‘×¨
				'#FB923C', // ×›×ª×•× ×‘×•×”×§
				'#F97316', // ×›×ª×•× ×¢×–
				'#EF4444', // ××“×•× ×¢×’×•×œ
			];

			// Initialize available colors if empty
			if (!data.availableColors || data.availableColors.length === 0) {
				data.availableColors = [...colors];
				// Shuffle the colors randomly
				data.availableColors.sort(() => Math.random() - 0.5);
			}

			function getRandomColor() {
				// If all colors used, reset and shuffle the pool
				if (data.availableColors.length === 0) {
					data.availableColors = [...colors];
					data.availableColors.sort(() => Math.random() - 0.5);
				}

				// Take the first color from the shuffled array
				const selectedColor = data.availableColors.shift();

				// Save the updated available colors
				saveData();

				return selectedColor;
			}

			function showPage(page) {
				document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
				document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));

				if (page === 'home') {
					document.getElementById('homePage').classList.add('active');
					document.querySelector('.nav-btn:nth-child(1)').classList.add('active');
					renderActivities();
				} else if (page === 'report') {
					document.getElementById('reportPage').classList.add('active');
					document.querySelector('.nav-btn:nth-child(2)').classList.add('active');
					renderReport();
				}
			}

			function openCreateActivityModal() {
				document.getElementById('createActivityModal').classList.add('active');
				document.getElementById('newActivityName').value = '';
				document.getElementById('newActivityHasPrice').checked = false;
			}

			function closeModal(modalId) {
				document.getElementById(modalId).classList.remove('active');
			}

			function createActivity() {
				const name = document.getElementById('newActivityName').value.trim();
				const hasPrice = document.getElementById('newActivityHasPrice').checked;

				if (!name) {
					alert('× × ×œ×”×–×™×Ÿ ×©× ×¤×¢×™×œ×•×ª');
					return;
				}

				const activity = {
					id: Date.now(),
					name: name,
					hasPrice: hasPrice,
					color: getRandomColor(),
				};

				// Add new activity at the beginning of the array
				data.activities.unshift(activity);
				saveData();
				closeModal('createActivityModal');
				renderActivities();
			}

			function renderActivities() {
				const grid = document.getElementById('activitiesGrid');
				grid.innerHTML = '';

				// Add the "+" button first
				const addButton = document.createElement('div');
				addButton.className = 'activity-card add-activity-card';
				addButton.onclick = openCreateActivityModal;
				addButton.textContent = '+';
				grid.appendChild(addButton);

				// Then add all activities (newest first due to unshift)
				data.activities.forEach(activity => {
					const logs = data.logs.filter(l => l.activityId === activity.id);
					const lastLog = logs.length > 0 ? logs[logs.length - 1] : null;
					const totalSpent = logs.reduce((sum, log) => sum + (log.price || 0), 0);

					const card = document.createElement('div');
					card.className = 'activity-card';
					card.style.background = activity.color;
					card.draggable = true;
					card.dataset.activityId = activity.id;

					let infoHTML = '';
					if (activity.hasPrice) {
						infoHTML += `<div class="activity-info">×¡×”"×›: â‚ª${totalSpent.toFixed(0)}</div>`;
					}
					if (lastLog) {
						infoHTML += `<div class="last-activity">××—×¨×•×Ÿ: ${formatDate(lastLog.timestamp)}</div>`;
					}

					card.innerHTML = `
                    <button class="edit-btn" onclick="event.stopPropagation(); editActivity(${activity.id})">âœ’ï¸</button>
                    <button class="delete-btn" onclick="event.stopPropagation(); deleteActivity(${activity.id})">Ã—</button>
                    <div class="activity-name">${activity.name}</div>
                    ${infoHTML}
                `;

					// Drag and drop event listeners
					card.addEventListener('dragstart', handleDragStart);
					card.addEventListener('dragend', handleDragEnd);
					card.addEventListener('dragover', handleDragOver);
					card.addEventListener('drop', handleDrop);
					card.addEventListener('dragleave', handleDragLeave);

					// Prevent click from firing when dragging
					let isDragging = false;
					card.addEventListener('mousedown', () => {
						isDragging = false;
					});
					card.addEventListener('mousemove', () => {
						isDragging = true;
					});
					card.addEventListener('mouseup', e => {
						if (!isDragging && !e.target.closest('.edit-btn') && !e.target.closest('.delete-btn')) {
							openLogActivityModal(activity);
						}
					});

					grid.appendChild(card);
				});
			}

			function openLogActivityModal(activity) {
				currentActivity = activity;
				document.getElementById('logActivityTitle').textContent = `×¨×™×©×•× ${activity.name}`;
				document.getElementById('activityPrice').value = '';

				const priceGroup = document.getElementById('priceGroup');
				priceGroup.style.display = activity.hasPrice ? 'block' : 'none';

				if (activity.hasPrice) {
					const priceInput = document.getElementById('activityPrice');
					priceInput.style.borderColor = '#e0e0e0';
				}

				// Show previous logs
				const logs = data.logs.filter(l => l.activityId === activity.id);
				const previousLogsDiv = document.getElementById('previousLogs');

				if (logs.length > 0) {
					previousLogsDiv.innerHTML = '<div class="previous-logs-title">×¨×™×©×•××™× ×§×•×“××™×:</div>';
					logs.slice(-5)
						.reverse()
						.forEach(log => {
							const logItem = document.createElement('div');
							logItem.className = 'log-item';
							logItem.textContent = `${formatDate(log.timestamp)}${log.price ? ` - â‚ª${log.price.toFixed(0)}` : ''}`;
							previousLogsDiv.appendChild(logItem);
							//add delete log button to the side
							const deleteLogButton = document.createElement('button');
							deleteLogButton.textContent = 'âŒ';
							deleteLogButton.style.float = 'left';
							deleteLogButton.style.border = 'none';
							deleteLogButton.style.cursor = 'pointer';
							//position it to the left side
							deleteLogButton.onclick = e => {
								e.stopPropagation();
								deleteLog(log.id);
							};
							logItem.appendChild(deleteLogButton);
						});
				} else {
					previousLogsDiv.innerHTML = '<div class="previous-logs-title">××™×Ÿ ×¨×™×©×•××™× ×§×•×“××™×</div>';
				}

				document.getElementById('logActivityModal').classList.add('active');
			}

			function deleteLog(logId) {
				data.logs = data.logs.filter(l => l.id !== logId);
				saveData();
				if (currentActivity) {
					openLogActivityModal(currentActivity); // Refresh the modal
				}
				renderActivities(); // Refresh the activities to update totals
			}

			function logActivity() {
				if (!currentActivity) return;

				const price = currentActivity.hasPrice ? parseFloat(document.getElementById('activityPrice').value) || 0 : null;
				const priceInput = document.getElementById('activityPrice');
				if (currentActivity.hasPrice && price <= 0) {
					priceInput.style.borderColor = 'red';
					return;
				} else {
					priceInput.style.borderColor = '#e0e0e0';
				}

				const log = {
					id: Date.now(),
					activityId: currentActivity.id,
					timestamp: new Date().toISOString(),
					price: price,
				};

				data.logs.push(log);
				saveData();
				closeModal('logActivityModal');
				renderActivities();
			}

			function deleteActivity(activityId) {
				activityToDelete = activityId;
				document.getElementById('deleteConfirmModal').classList.add('active');
			}

			function editActivity(activityId) {
				const activity = data.activities.find(a => a.id === activityId);
				if (!activity) return;

				activityToEdit = activity;
				selectedColor = activity.color;

				document.getElementById('editActivityName').value = activity.name;

				// Render color picker
				const colorPicker = document.getElementById('colorPicker');
				colorPicker.innerHTML = '';

				colors.forEach(color => {
					const colorOption = document.createElement('div');
					colorOption.className = 'color-option';
					colorOption.style.background = color;
					if (color === selectedColor) {
						colorOption.classList.add('selected');
					}
					colorOption.onclick = () => selectColor(color);
					colorPicker.appendChild(colorOption);
				});

				document.getElementById('editActivityModal').classList.add('active');
			}

			function selectColor(color) {
				selectedColor = color;
				document.querySelectorAll('.color-option').forEach(option => {
					option.classList.remove('selected');
					if (option.style.background === color) {
						option.classList.add('selected');
					}
				});
			}

			function saveActivityEdit() {
				if (!activityToEdit) return;

				const newName = document.getElementById('editActivityName').value.trim();

				if (!newName) {
					alert('× × ×œ×”×–×™×Ÿ ×©× ×¤×¢×™×œ×•×ª');
					return;
				}

				activityToEdit.name = newName;
				activityToEdit.color = selectedColor;

				saveData();
				closeModal('editActivityModal');
				activityToEdit = null;
				selectedColor = null;
				renderActivities();
			}

			// Drag and drop functions
			function handleDragStart(e) {
				draggedElement = e.currentTarget;
				draggedActivityId = parseInt(e.currentTarget.dataset.activityId);
				e.currentTarget.classList.add('dragging');
				e.dataTransfer.effectAllowed = 'move';
			}

			function handleDragEnd(e) {
				e.currentTarget.classList.remove('dragging');
				document.querySelectorAll('.activity-card').forEach(card => {
					card.classList.remove('drag-over');
				});
			}

			function handleDragOver(e) {
				if (e.preventDefault) {
					e.preventDefault();
				}
				e.dataTransfer.dropEffect = 'move';

				const targetCard = e.currentTarget;
				if (targetCard !== draggedElement && targetCard.dataset.activityId) {
					targetCard.classList.add('drag-over');
				}

				return false;
			}

			function handleDragLeave(e) {
				e.currentTarget.classList.remove('drag-over');
			}

			function handleDrop(e) {
				if (e.stopPropagation) {
					e.stopPropagation();
				}

				e.currentTarget.classList.remove('drag-over');

				const targetActivityId = parseInt(e.currentTarget.dataset.activityId);

				if (draggedActivityId !== targetActivityId) {
					// Find the indices
					const draggedIndex = data.activities.findIndex(a => a.id === draggedActivityId);
					const targetIndex = data.activities.findIndex(a => a.id === targetActivityId);

					if (draggedIndex !== -1 && targetIndex !== -1) {
						// Swap the activities
						const temp = data.activities[draggedIndex];
						data.activities[draggedIndex] = data.activities[targetIndex];
						data.activities[targetIndex] = temp;

						saveData();
						renderActivities();
					}
				}

				return false;
			}

			function confirmDelete() {
				if (!activityToDelete) return;

				// Remove activity
				data.activities = data.activities.filter(a => a.id !== activityToDelete);

				// Remove all logs for this activity
				data.logs = data.logs.filter(l => l.activityId !== activityToDelete);

				saveData();
				closeModal('deleteConfirmModal');
				activityToDelete = null;
				renderActivities();
			}

			function formatDate(timestamp) {
				const now = new Date();
				const date = new Date(timestamp);
				const diffMs = now - date;
				const diffMins = Math.floor(diffMs / 60000);
				const diffHours = Math.floor(diffMs / 3600000);
				const diffDays = Math.floor(diffMs / 86400000);
				const diffWeeks = Math.floor(diffDays / 7);
				const diffMonths = Math.floor(diffDays / 30);

				if (diffMins < 1) return '×›×¨×’×¢';
				if (diffMins < 60) return `×œ×¤× ×™ ${diffMins} ×“×§×•×ª`;
				if (diffHours < 24) return `×œ×¤× ×™ ${diffHours} ×©×¢×•×ª`;
				if (diffDays === 1) return '×œ×¤× ×™ ×™×•×';
				if (diffDays < 7) return `×œ×¤× ×™ ${diffDays} ×™××™×`;
				if (diffWeeks === 1) return '×œ×¤× ×™ ×©×‘×•×¢';
				if (diffDays < 30) return `×œ×¤× ×™ ${diffWeeks} ×©×‘×•×¢×•×ª`;
				if (diffMonths === 1) return '×œ×¤× ×™ ×—×•×“×©';
				if (diffMonths < 12) return `×œ×¤× ×™ ${diffMonths} ×—×•×“×©×™×`;

				const day = String(date.getDate()).padStart(2, '0');
				const month = String(date.getMonth() + 1).padStart(2, '0');
				const year = String(date.getFullYear()).slice(-2);
				return `${day}/${month}/${year}`;
			}

			function renderReport() {
				const historyList = document.getElementById('historyList');
				historyList.innerHTML = '';

				let grandTotal = 0;

				data.activities.forEach(activity => {
					const logs = data.logs.filter(l => l.activityId === activity.id);
					if (logs.length === 0) return;

					const section = document.createElement('div');
					section.className = 'activity-section';

					const activityTotal = logs.reduce((sum, log) => sum + (log.price || 0), 0);
					grandTotal += activityTotal;

					let titleHTML = `<div class="activity-section-title">${activity.name}`;
					if (activity.hasPrice) {
						titleHTML += ` - ×¡×”"×›: â‚ª${activityTotal.toFixed(0)}`;
					}
					titleHTML += `</div>`;

					section.innerHTML = titleHTML;

					logs.forEach(log => {
						const item = document.createElement('div');
						item.className = 'history-item';
						item.innerHTML = `
                        <span class="history-date">${formatDate(log.timestamp)}</span>
                        ${log.price ? `<span class="history-price">â‚ª${log.price.toFixed(0)}</span>` : ''}
                    `;
						section.appendChild(item);
					});

					historyList.appendChild(section);
				});

				if (grandTotal > 0) {
					const totalSection = document.createElement('div');
					totalSection.className = 'total-section';
					totalSection.textContent = `×¡×”"×› ×”×•×¦××•×ª: â‚ª${grandTotal.toFixed(0)}`;
					historyList.appendChild(totalSection);
				}

				if (data.logs.length === 0) {
					historyList.innerHTML = '<div class="activity-section"><div class="activity-section-title">××™×Ÿ ×¤×¢×™×œ×•×™×•×ª ×©× ×¨×©××• ×¢×“×™×™×Ÿ</div></div>';
				}
			}

			// Initialize
			renderActivities();
		</script>
	</body>
</html>
